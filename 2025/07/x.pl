use v5.40;

my $sr = 0;
my $sc = 0;
my @map = ();
while(<DATA>) {
	chomp;
	if($_ !~ /S/) {
		my @r = split //;
		push @map, \@r;
	} else {
		my @r = split //;
		push @map, \@r;
		foreach(@r) {
			if($_ ne 'S') { $sc++ } else { last; }
		}
	}
}
say "S is at $sr $sc";

my %beams_launch_pos = ();
launch_beam($sr, $sc);
say "Solution: " . scalar(keys(%beams_launch_pos));

sub launch_beam {
	my ($s, $c) = @_;
	while($s+1 < @map && $map[$s+1][$c] eq '.' ) {
		$s++;
	}
	if($s+1 < @map && $map[$s+1][$c] eq '^') {
		if(!$beams_launch_pos{($s+1) . '#' . $c}) { # we've not already been here
			$beams_launch_pos{($s+1) . '#' . $c} = 1;
			if($c > 0) {
				launch_beam($s+1, $c-1);
			}
			if($c < @{$map[0]}-1) {
				launch_beam($s+1, $c+1);
			}
		}
	}
}

__DATA__
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^...^.^...................................................................
.............................................................................................................................................
..................................................................^.^...^.^..................................................................
.............................................................................................................................................
.................................................................^.^.^.^.^.^.................................................................
.............................................................................................................................................
................................................................^.^...^...^.^................................................................
.............................................................................................................................................
...............................................................^.^.^...^.^.^.^...............................................................
.............................................................................................................................................
..............................................................^...^.^.....^.^.^..............................................................
.............................................................................................................................................
.............................................................^...^.^...^.....^.^.............................................................
.............................................................................................................................................
............................................................^.^.....^.^.^...^...^............................................................
.............................................................................................................................................
...........................................................^.^.^.....^.^.^.^.^.^.^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^.^.^.^.......^.^.^..........................................................
.............................................................................................................................................
.........................................................^.^.^...^.^.^...^.^.^.^...^.........................................................
.............................................................................................................................................
........................................................^.^.^...^...^.^.^.^.^.^.^.^.^........................................................
.............................................................................................................................................
.......................................................^.^...^.^.^.^.^...^.^.^.^.....^.......................................................
.............................................................................................................................................
......................................................^...^.^...^.^.^.^.^.^...^...^.^.^......................................................
.............................................................................................................................................
.....................................................^.^.^.^...^...^.^.^.^.^.^.^.^.....^.....................................................
.............................................................................................................................................
....................................................^.....^.^.....^.^...^.^.^...^.^...^.^....................................................
.............................................................................................................................................
...................................................^...^.....^.^...^.^.^.^...^.^.^.^...^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^...^.......^.....^.^.^.....^...^.^..................................................
.............................................................................................................................................
.................................................^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.................................................
.............................................................................................................................................
................................................^.^...^.^.^...^.^...^...^.^...^.....^.....^.^................................................
.............................................................................................................................................
...............................................^.^.^...^...^.^.^.....^.^.^.^.^.^.^.^.^.^.....^...............................................
.............................................................................................................................................
..............................................^...^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^...^..............................................
.............................................................................................................................................
.............................................^.^.^.^.^.^...^.^.^.....^...^.^.^...^.^.^...^...^.^.............................................
.............................................................................................................................................
............................................^...^.^.^.^...^...^...^.^.^.....^.^.........^.^.....^............................................
.............................................................................................................................................
...........................................^...^.^.^.^.^.^.^.^...^...^.^.^.^.....^.^.^.^.^...^...^...........................................
.............................................................................................................................................
..........................................^...^.^...^...^...^...^.^...^.....^.^.^.^...^.^.^.^.^.^.^..........................................
.............................................................................................................................................
.........................................^.........^...^...^...^...^...^.^...^.^.^.......^...^...^.^.........................................
.............................................................................................................................................
........................................^.^.^.^.^...^...^.^.^.....^...^.^...^...^...^.....^.^...^.^.^........................................
.............................................................................................................................................
.......................................^.....^.^.^...^.^.......^.^...^...^.^.^.^.......^...^.^.^.^.^.^.......................................
.............................................................................................................................................
......................................^.^.^.^.^...^...^.^.^.^.^...^.^.^.......^.^.....^.^.^.....^.^.^.^......................................
.............................................................................................................................................
.....................................^.^.^.^.^.^.....^.^.^.^.......^...^...^.^.^...^.^.^.^.^.^...^.^.^.^.....................................
.............................................................................................................................................
....................................^...^.^.^.^.^.....^...^.....^.^.....^.^.^.^.^.^.^.^...^.....^.^.^.^.^....................................
.............................................................................................................................................
...................................^...^...^...^.^...^.^.^.^...^...^.......^.^...^.^.^.^.^...^.^.....^...^...................................
.............................................................................................................................................
..................................^.^.^.^.^.^.....^.^.^.^.^...^...^.......^.^...^...^.^.^.^.^.^.^.^...^.^.^..................................
.............................................................................................................................................
.................................^.^...^.........^.....^.^.....^.....^.^.^.^.^.^.......^...^.^.^...^.^.^...^.................................
.............................................................................................................................................
................................^.^.^.....^.^...^...^.^.....^...^...^...^.....^.^.^.^...^.^.^...^...^.^.^.^.^................................
.............................................................................................................................................
...............................^.^.^...^.^...^...^.^.^.^.^.^.^.^.^.^.^.............^.^.....^.^...^...^.^.^.^.^...............................
.............................................................................................................................................
..............................^.......^.^.^.^...^.^.^.^.....^.^.^.^.^...^.....^.^...^...^.^.^.^.^.^.^.....^.^.^..............................
.............................................................................................................................................
.............................^.....^.^.^.^...^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^...^...^.^...^.^...^.^.^.^.^.............................
.............................................................................................................................................
............................^.....^.^.^...^...^...^.^.^.^...^.^.....^.^.^.....^.^...^.^...^.....^...^.^.^.^.....^............................
.............................................................................................................................................
...........................^.^...^...^.^.^.^...^...^.^...^.^.^...^.^.^...^.^.^.....^.^.^.^.^.^...^.^.....^.^.^...^...........................
.............................................................................................................................................
..........................^...^.....^...^.^.^...^...^.^.^.^.^.^...^.^.^...^.^...^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^..........................
.............................................................................................................................................
.........................^.^.....^.^.^.....^.^.^.^.^.^.^.^...^...^.^.....^...^.^.^.....^.^.^...^.^.^...^.^...^.^...^.........................
.............................................................................................................................................
........................^.^.^...^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.^...^.^...^.^.^.^.....^.^.^.^.^...^...^...^.^.....^........................
.............................................................................................................................................
.......................^.^...^.^.^...^...^...^.^.^.^.....^.^.^...^.....^...^.^.^.^...^...^.^.....^.^.^.^.^.^.^.^...^.^.......................
.............................................................................................................................................
......................^.^.^.^.^...^...^.^.^...^.^.^...^...^.^.....^.^.....^.^.^.^...^.^.^.^.^.^...^.^...^...^.^.....^.^......................
.............................................................................................................................................
.....................^...^.....^...^...^.^...^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.......^...^.....................
.............................................................................................................................................
....................^.^.^.....^.^.^...^.^...^.^.^.^.^.....^...^...^.^.....^.^.^.^...^.^...^...^...^.^.^.^.^...^.......^.^....................
.............................................................................................................................................
...................^...^.^.^.^.^.^...^.^.^...^...^.^.^.^.^.^.....^.^.......^.....^...^.^...^.^...^...^.^.^.^.^...^.^...^.^...................
.............................................................................................................................................
..................^.^.^.^.^.^.^.^.^.....^.........^.^.....^.^.^.^.^.^.^.^...^...^.^...^...^...^...^.......^...^.^.^...^...^..................
.............................................................................................................................................
.................^.^.^.^...^.^.^.^.......^.^...^.^.^.^.^...^...^.^...^.....^.^...^.^.^.^.....^.^.^.....^.^.......^.^.^.^.^.^.................
.............................................................................................................................................
................^.^.^...........^.......^.^.^.^...^.^.^...^.......^.^...^.....^.^.^...^.^.^.^...^.^.^.....^.^.^.^.^.....^.^.^................
.............................................................................................................................................
...............^.^.^.^.^.^.^...^.........^.^.^.^.^.^.^...^.^.....^.....^.^.^.^.^.^.^...^.^.^...^.^.^...^.^.^...^.....^.^.^.^.^...............
.............................................................................................................................................
..............^...^.^.^.^.^...^.^.^.^.^.^...^.....^.^.^...^.^...^.^.^.^.^...^.^.^.....^.....^.....^.^.......^.^.....^.^.^.....^..............
.............................................................................................................................................
.............^.^...^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.........^.^.....^.^.....^.^.^...^.............
.............................................................................................................................................
............^...^.^.^.^...^.......^.^...^.^.^.^...^.^.....^.^.^.^.....^.^.^.....^.^.^.^...^.^.^.....^.....^.^...^.^.^.^.^...^...^............
.............................................................................................................................................
...........^.^...^...^.^.^...^.^.^.......^.^.^.......^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^...^.......^.^...^...^.^...^.^.^.^.^.^.^...........
.............................................................................................................................................
..........^...^...^...^.^.^.^...^.....^.^...^.....^.^.^.^...^.^...^.^...^.^.^.^...^.^.^.......^...^.^.....^...^.^.^.^...^.^.^.^.^.^..........
.............................................................................................................................................
.........^.^.^...^.^.^.^...^...^.^...^.^.^.^.^...^...^.^.^...^...^.^.^.^.^.....^.^.^.^.^.^.^.^.....^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.........
.............................................................................................................................................
........^.^.^.^...^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.^...^.^.^.^...^.^.....^...^...^.^.^...^...^.....^.^.^.^.^.^.^.^........
.............................................................................................................................................
.......^.^.....^.^.^.^...^.^.......^.........^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.^...^.^.^.^.^...^.^...^...^.^.^.^.^.^.....^.^.^.^.^.^.^.......
.............................................................................................................................................
......^...^.^.^.^.^...^.^.^.....^.^.........^.....^.^.^...^...^.^.^...^.^.^.^...^.....^.^.^.^.^.^.^.......^...^.....^.^.^.^.^.....^.^.^......
.............................................................................................................................................
.....^...^.^...^.^.....^.^.^.^.^.....^.^.^.^.^.^.^.^.......^.^...^.^.^.^.^.....^.^.^...^...^.^.^.^...^...^.^.^...^.......^.^.^...^.^.^.^.....
.............................................................................................................................................
....^.^.^.^.^.^.....^.^...^...^.^.^.^...^...^.^...^...^.....^.^.^.^.^.^.....^.......^.^.^.^.^.^.^.^...^.^.......^...^...^.^.^.^...^.^.^.^....
.............................................................................................................................................
...^.^.^...^.^.^.^.^...^.^.^...^.^.......^.^.^.^...^.^.^.^.^.^.^.^.^.^.......^.^.^.^.^.^.^.....^.........^.......^.^...^.^.^.^.^.^.^.^.^.^...
.............................................................................................................................................
..^.^.^...^.^.^.^...^...^.^...^...^...^.^.^.^.....^.^...^.....^...^.^...^.^.^.^.^...^...^...^.^.^.^.^.^...^...^.^.^.....^.^.^.^.....^.^.^.^..
.............................................................................................................................................
.^.....^.^.^.^.^.^.......^.^.....^.^.^.^.^.^...^.......^.^.....^.^.^...^.^...^.^.....^.^...^.^...^.^...........^.^.^.^...^.^.....^...^.....^.
.............................................................................................................................................
