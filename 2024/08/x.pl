use v5.36;

my %locs = ();
my @antimap = ();
my $width = 0;
my $height = 0;
while(<DATA>) {
	say;
	chomp;
	my @row = split //;
	my $i = 0;
	foreach(@row) {
		if($_ ne '.') {
			if(exists($locs{$_})) {
				push @{$locs{$_}}, [$height, $i];
			} else {
				$locs{$_} = [[$height, $i]];
			}
		}
		$i++
	}
	$width = @row;
	my $anti = '.' x $width;
	my @antidots = split //, $anti;
	$antimap[$height] = \@antidots;
	$height++;
}
say "Grid is width=$width, height=$height";

foreach my $char (keys(%locs)) {
	my @pos = @{$locs{$char}};
	say "$char positions: @pos";
	for(my $i = 0; $i < @pos; $i++) {
		for(my $j = 0; $j < @pos; $j++) {
			next if $i == $j;
			my ($r1, $c1) = @{$pos[$i]};
			my ($r2, $c2) = @{$pos[$j]};
			my $diff_r = $r1 - $r2;
			my $diff_c = $c1 - $c2;
			my ($r3, $c3) = ($r1 + $diff_r, $c1 + $diff_c);
			if($r3 < $height && $r3 > -1 && $c3 < $width && $c3 > -1) {
				say "New point: ($r3, $c3)";
				$antimap[$r3][$c3] = '#';
			}
		}
	}
}

say "Antimap";
my $uniq = 0;
foreach(@antimap) {
	say "@{$_}";
	$uniq += grep { $_ eq '#' } @{$_};
}
say "Sol: $uniq";

__DATA__
.C...............w.......................M.E......
...............G........V.............Q....M......
u........k...........V.y..3........Q..........4.a.
..........c.9........k..................i..7..a...
..............y.......................o....a......
.......C...........6.......y.............E........
.............................5....x............i..
...............c.....wy..V.......5..............E.
........k.......c....G..I............o.........m..
............C....s......G......o..........5.......
......................Q...............5....e...4i.
.....I.....................................m.....j
....9K.T.....I...c......w...................X.....
................I.........w....f............3..e.N
C............9..........6..............7...3......
...Z........K.......T.................6...........
......Z..................6...............HN.E.m...
...K...........................1....N...e.o..X....
............hz......................7........j....
.........9......U.R......n.....4.Q..L...X.........
..................A...........S.......0...........
...............l.........p...........2.3M.......x.
.h........................U.................g.....
...Hld...........A..W.......................1x....
.....Z.....n.......lp...e............Xj...L.......
........hU................7...j...S...............
......n............U..........D....S..q...........
....H.....d.r..T..............0..........L.S......
......H......A..T...lp.........LK....1.....2.f.x..
....Z............................g....4...........
..d..r............V...............f..g....2.......
.rn.........D............Pp........q....g.........
..................................................
...................D...0.........Y..t...P.q.......
.......R.s.......................q.P..1...........
...........h..........................2.........f.
........................W.........................
...8...........O................k.................
....rY...........D................P...............
....................O...u.........................
..s..................F............................
...................R......F.......................
......8...........z0....F................J.W......
...................F..z................u..........
..............R.........O.............v.Jt........
s.............8.........m........J.t............v.
......Y.....M........................u..tv........
.................................................v
..................................................
.................z.W..................J...........
